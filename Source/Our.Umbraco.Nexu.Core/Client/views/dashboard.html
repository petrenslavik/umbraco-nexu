<div ng-controller="Our.Umbraco.Nexu.DashboardController">
    <div ng-hide="isLoading">
        <div ng-hide="RebuildStatus.IsProcessing" class="nexu-container">
            <div class="btn-group">
                <a class="btn" ng-click="rebuild()" prevent-default>
                    <localize key="nexu_dashboardRebuild">Rebuild relations</localize>
                </a>
                <a class="btn" ng-click="getUnusedMedia()" ng-disabled = "unusedMedia.IsProcessingMedia" prevent-default>
                    <localize key="nexu_dashboardUnusedMedia">Get unused media</localize>
                </a>
                <a class="btn" ng-click="deleteUnusedMedia()" ng-disabled="filteredMedia.length == 0" prevent-default>
                    Delete found media
                </a>
                <input class="hidden-input" id="exceptionListLoader" type="file" class="btn" on-read-file="showContent( fileContent, fileName )" >
                    <label class="input-label btn" for="exceptionListLoader">Load exception list</label>
            </div> 
            <div class="input-source" ng-show="exceptionListSource">
                {{exceptionListSource}}
            </div>
        </div>
        <div ng-show="RebuildStatus.IsProcessing">
            <p>
                <localize key="nexu_dashboardRebuildInProgress">Rebuilding nexu relations in progress</localize> ({{RebuildStatus.ItemsProcessed}} <localize key="nexu_dashboardItemsProcessed">items processed</localize>)
            </p>
            <p>
                <input type="checkbox" ng-model="autoRefresh" ng-checked="autoRefresh" /> <localize key="nexu_dashboardAutorefresh">Auto-refresh every 5 seconds</localize>
            </p>
            <p ng-hide="autoRefresh">
                <a class="btn" ng-click="getRebuildStatus()" prevent-default>
                    <localize key="nexu_dashboardRefresh">Refresh status</localize>
                </a>
            </p>
        </div>
        <div ng-show="filteredMedia.length != 0">
            <table class="table">
                <caption>Unused media</caption>
                <thead>
                    <tr>
                        <th>Index</th>
                        <th>Name</th>
                        <th>Path</th>
                        <th>Source</th>
                        <th>ToRemove</th>
                    </tr>
                </thead>
                <tbody>
                    <tr ng-repeat="link in filteredMedia">
                        <td>{{$index + 1}}</td>
                        <td>{{link.Name}}</td>
                        <td>{{link.Path}}</td>
                        <td ng-show="link.Source != null"><a href="{{link.Source}}">Source</a></td>
                        <td ng-show="link.Source == null">Source not available</td>
                        <td><input type="checkbox" ng-model="filteredMedia[$index].ToRemove" /></td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>